<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - EAnh</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">EAnh Admin</div>
                <nav>
                    <ul class="nav-menu">
                        <li><a href="admin-dashboard.html" class="active">Dashboard</a></li>
                        <li><a href="backend/auth/logout.php">ƒêƒÉng xu·∫•t</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="container" style="margin-top: 2rem;">
        <div class="dashboard-grid">
            <!-- Admin Sidebar -->
            <aside class="sidebar">
                <h3 style="margin-bottom: 1.5rem; color: var(--text-light);">Qu·∫£n l√Ω</h3>
                <ul class="sidebar-menu">
                    <li>
                        <a href="#users" onclick="showSection('users')">
                            <span>üë•</span>
                            <span>Ng∆∞·ªùi d√πng</span>
                        </a>
                    </li>
                    <li>
                        <a href="#vocabulary" onclick="showSection('vocabulary')">
                            <span>üìö</span>
                            <span>T·ª´ v·ª±ng</span>
                        </a>
                    </li>
                    <li>
                        <a href="#grammar" onclick="showSection('grammar')">
                            <span>üìñ</span>
                            <span>Ng·ªØ ph√°p</span>
                        </a>
                    </li>
                    <li>
                        <a href="#tests" onclick="showSection('tests')">
                            <span>üìù</span>
                            <span>B√†i ki·ªÉm tra</span>
                        </a>
                    </li>
                    <li>
                        <a href="#stats" onclick="showSection('stats')">
                            <span>üìä</span>
                            <span>Th·ªëng k√™</span>
                        </a>
                    </li>
                </ul>
            </aside>

            <!-- Main Content -->
            <main>
                <h1 style="margin-bottom: 2rem;">Qu·∫£n tr·ªã h·ªá th·ªëng üõ†Ô∏è</h1>

                <!-- System Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalUsers">0</div>
                        <div class="stat-label">T·ªïng ng∆∞·ªùi d√πng</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);">
                        <div class="stat-value" id="totalVocab">0</div>
                        <div class="stat-label">T·ª´ v·ª±ng</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <div class="stat-value" id="totalTests">0</div>
                        <div class="stat-label">B√†i ki·ªÉm tra</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #ec4899, #db2777);">
                        <div class="stat-value" id="activeToday">0</div>
                        <div class="stat-label">Ho·∫°t ƒë·ªông h√¥m nay</div>
                    </div>
                </div>

                <!-- Users Section -->
                <div id="usersSection" class="admin-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>
                        <button class="btn btn-primary" onclick="showAddUserModal()">
                            + Th√™m ng∆∞·ªùi d√πng
                        </button>
                    </div>
                    
                    <div class="card">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="border-bottom: 1px solid var(--border);">
                                    <th style="padding: 1rem; text-align: left;">ID</th>
                                    <th style="padding: 1rem; text-align: left;">Email</th>
                                    <th style="padding: 1rem; text-align: left;">H·ªç t√™n</th>
                                    <th style="padding: 1rem; text-align: left;">Vai tr√≤</th>
                                    <th style="padding: 1rem; text-align: left;">Ng√†y t·∫°o</th>
                                    <th style="padding: 1rem; text-align: left;">Thao t√°c</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <tr>
                                    <td colspan="6" style="padding: 2rem; text-align: center; color: var(--text-gray);">
                                        ƒêang t·∫£i d·ªØ li·ªáu...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Vocabulary Section -->
                <div id="vocabularySection" class="admin-section hidden">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2>Qu·∫£n l√Ω t·ª´ v·ª±ng</h2>
                        <button class="btn btn-primary" onclick="showAddVocabModal()">
                            + Th√™m t·ª´ v·ª±ng
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="form-group">
                            <input type="text" class="form-control" id="searchVocab" placeholder="T√¨m ki·∫øm t·ª´ v·ª±ng...">
                        </div>
                        <div id="vocabList" style="margin-top: 1rem;">
                            <p style="color: var(--text-gray); text-align: center; padding: 2rem;">
                                ƒêang t·∫£i d·ªØ li·ªáu...
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Grammar Section -->
                <div id="grammarSection" class="admin-section hidden">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2>Qu·∫£n l√Ω ng·ªØ ph√°p</h2>
                        <button class="btn btn-primary" onclick="showAddGrammarModal()">
                            + Th√™m b√†i ng·ªØ ph√°p
                        </button>
                    </div>
                    
                    <div class="card">
                        <div id="grammarList">
                            <p style="color: var(--text-gray); text-align: center; padding: 2rem;">
                                ƒêang t·∫£i d·ªØ li·ªáu...
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Tests Section -->
                <div id="testsSection" class="admin-section hidden">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2>Qu·∫£n l√Ω b√†i ki·ªÉm tra</h2>
                        <button class="btn btn-primary" onclick="showAddTestModal()">
                            + T·∫°o b√†i ki·ªÉm tra
                        </button>
                    </div>
                    
                    <div class="card">
                        <div id="testsList">
                            <p style="color: var(--text-gray); text-align: center; padding: 2rem;">
                                ƒêang t·∫£i d·ªØ li·ªáu...
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Stats Section -->
                <div id="statsSection" class="admin-section hidden">
                    <h2 style="margin-bottom: 1.5rem;">Th·ªëng k√™ chi ti·∫øt</h2>
                    
                    <div class="grid grid-2">
                        <div class="card">
                            <h3 class="card-title">Ng∆∞·ªùi d√πng m·ªõi theo th√°ng</h3>
                            <canvas id="userChart" height="200"></canvas>
                        </div>
                        
                        <div class="card">
                            <h3 class="card-title">Ho·∫°t ƒë·ªông h·ªçc t·∫≠p</h3>
                            <canvas id="activityChart" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Section management
        function showSection(sectionName) {
            const sections = document.querySelectorAll('.admin-section');
            sections.forEach(section => section.classList.add('hidden'));
            
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Update active menu
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.classList.remove('active');
            });
            event.target.closest('a').classList.add('active');
        }

        // Load admin stats
        async function loadAdminStats() {
            try {
                const response = await fetch('backend/api/admin-stats.php');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalUsers').textContent = data.total_users || 0;
                    document.getElementById('totalVocab').textContent = data.total_vocab || 0;
                    document.getElementById('totalTests').textContent = data.total_tests || 0;
                    document.getElementById('activeToday').textContent = data.active_today || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load users
        async function loadUsers() {
            try {
                const response = await fetch('backend/api/admin-users.php');
                const data = await response.json();
                
                const tbody = document.getElementById('usersTable');
                
                if (data.success && data.users.length > 0) {
                    tbody.innerHTML = data.users.map(user => `
                        <tr style="border-bottom: 1px solid var(--border);">
                            <td style="padding: 1rem;">${user.id}</td>
                            <td style="padding: 1rem;">${user.email}</td>
                            <td style="padding: 1rem;">${user.full_name || '-'}</td>
                            <td style="padding: 1rem;">
                                <span style="padding: 0.25rem 0.75rem; background: ${user.role === 'admin' ? 'var(--danger)' : 'var(--primary)'}; border-radius: 4px; font-size: 0.85rem;">
                                    ${user.role}
                                </span>
                            </td>
                            <td style="padding: 1rem;">${new Date(user.created_at).toLocaleDateString('vi-VN')}</td>
                            <td style="padding: 1rem;">
                                <button class="btn btn-danger" onclick="deleteUser(${user.id})" style="padding: 0.5rem 1rem; font-size: 0.85rem;">
                                    X√≥a
                                </button>
                            </td>
                        </tr>
                    `).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="6" style="padding: 2rem; text-align: center; color: var(--text-gray);">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>';
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // Modal placeholders
        function showAddUserModal() {
            alert('Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn');
        }
        
        function showAddVocabModal() {
            alert('Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn');
        }
        
        function showAddGrammarModal() {
            alert('Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn');
        }
        
        function showAddTestModal() {
            alert('Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn');
        }

        function deleteUser(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y?')) {
                alert('Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn');
            }
        }

        // Initialize
        loadAdminStats();
        loadUsers();
    </script>
</body>
</html>