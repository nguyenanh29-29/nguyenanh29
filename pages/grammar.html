<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc Ng·ªØ Ph√°p - EAnh</title>
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">EAnh</div>
                <nav>
                    <ul class="nav-menu">
                        <li><a href="../dashboard.html">Dashboard</a></li>
                        <li><a href="grammar.html" class="active">Ng·ªØ ph√°p</a></li>
                        <li><a href="../backend/auth/logout.php">ƒêƒÉng xu·∫•t</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="container" style="margin-top: 2rem; margin-bottom: 2rem;">
        <h1 style="margin-bottom: 2rem;">üìñ H·ªçc Ng·ªØ Ph√°p</h1>

        <div class="grid grid-2">
            <!-- Sidebar -->
            <div>
                <div class="card">
                    <h3 class="card-title">C·∫•p ƒë·ªô</h3>
                    <select class="form-control" id="levelFilter" onchange="loadGrammar()">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="A1">A1 - C∆° b·∫£n</option>
                        <option value="A2">A2 - S∆° c·∫•p</option>
                        <option value="B1" selected>B1 - Trung c·∫•p</option>
                        <option value="B2">B2 - Trung cao</option>
                        <option value="C1">C1 - Cao c·∫•p</option>
                    </select>
                </div>

                <div class="card" style="margin-top: 1rem;">
                    <h3 class="card-title">Danh s√°ch b√†i h·ªçc</h3>
                    <div id="grammarList" style="max-height: 500px; overflow-y: auto;">
                        <p style="color: var(--text-gray); text-align: center; padding: 2rem;">
                            ƒêang t·∫£i...
                        </p>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div>
                <div class="card" id="grammarContent">
                    <div style="text-align: center; padding: 3rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üìñ</div>
                        <h3 style="margin-bottom: 1rem;">Ch·ªçn b√†i h·ªçc ƒë·ªÉ b·∫Øt ƒë·∫ßu</h3>
                        <p style="color: var(--text-gray);">Ch·ªçn c·∫•p ƒë·ªô v√† b√†i h·ªçc ph√π h·ª£p v·ªõi b·∫°n</p>
                    </div>
                </div>

                <div class="card hidden" id="exerciseSection" style="margin-top: 1rem;">
                    <h3 class="card-title">B√†i t·∫≠p th·ª±c h√†nh</h3>
                    <div id="exerciseContent"></div>
                    <button class="btn btn-primary mt-2" onclick="checkAnswers()">Ki·ªÉm tra ƒë√°p √°n</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentGrammar = null;

        async function loadGrammar() {
            const level = document.getElementById('levelFilter').value;
            try {
                const params = level ? `?level=${level}` : '';
                const response = await fetch(`../backend/api/grammar.php${params}`);
                const data = await response.json();

                const listContainer = document.getElementById('grammarList');
                if (data.success && data.grammar.length > 0) {
                    listContainer.innerHTML = data.grammar.map(item => `
                        <div style="padding: 1rem; border-bottom: 1px solid var(--border); cursor: pointer;" onclick="showGrammar(${item.id})">
                            <h4 style="margin-bottom: 0.5rem; color: var(--primary);">${item.title}</h4>
                            <small style="color: var(--text-gray);">C·∫•p ƒë·ªô: ${item.level}</small>
                        </div>
                    `).join('');
                } else {
                    listContainer.innerHTML = '<p style="color: var(--text-gray); text-align: center; padding: 2rem;">Kh√¥ng c√≥ b√†i h·ªçc</p>';
                }
            } catch (error) {
                console.error('Error loading grammar:', error);
            }
        }

        async function showGrammar(id) {
            try {
                const response = await fetch(`../backend/api/grammar.php?id=${id}`);
                const data = await response.json();

                if (data.success) {
                    currentGrammar = data.grammar;
                    const content = document.getElementById('grammarContent');
                    
                    const examples = data.grammar.examples ? data.grammar.examples.split('|') : [];
                    
                    content.innerHTML = `
                        <h2 class="card-title">${data.grammar.title}</h2>
                        <div style="color: var(--text-gray); margin-bottom: 2rem;">
                            <small>C·∫•p ƒë·ªô: ${data.grammar.level}</small>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <h3 style="margin-bottom: 1rem;">N·ªôi dung:</h3>
                            <p style="line-height: 1.8;">${data.grammar.content}</p>
                        </div>

                        ${examples.length > 0 ? `
                            <div>
                                <h3 style="margin-bottom: 1rem;">V√≠ d·ª•:</h3>
                                <ul style="list-style: none; padding: 0;">
                                    ${examples.map(ex => `
                                        <li style="padding: 0.5rem 1rem; background: rgba(99, 102, 241, 0.1); border-left: 3px solid var(--primary); margin-bottom: 0.5rem;">
                                            ${ex}
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        ` : ''}

                        <button class="btn btn-success mt-2" onclick="saveProgress()">‚úì ƒê√£ hi·ªÉu</button>
                    `;

                    // Show exercise section if available
                    if (data.grammar.exercises) {
                        document.getElementById('exerciseSection').classList.remove('hidden');
                        loadExercises(data.grammar.exercises);
                    }
                }
            } catch (error) {
                console.error('Error loading grammar detail:', error);
            }
        }

        function loadExercises(exercises) {
            // Simple exercise placeholder
            document.getElementById('exerciseContent').innerHTML = `
                <p style="color: var(--text-gray); padding: 1rem;">B√†i t·∫≠p s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t sau</p>
            `;
        }

        function checkAnswers() {
            alert('Ch·ª©c nƒÉng ki·ªÉm tra ƒë√°p √°n ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn');
        }

        async function saveProgress() {
            if (!currentGrammar) return;

            try {
                const response = await fetch('../backend/api/grammar.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        grammar_id: currentGrammar.id,
                        completed: true
                    })
                });

                const data = await response.json();
                if (data.success) {
                    alert('ƒê√£ l∆∞u ti·∫øn ƒë·ªô!');
                }
            } catch (error) {
                console.error('Error saving progress:', error);
            }
        }

        loadGrammar();
    </script>
</body>
</html>