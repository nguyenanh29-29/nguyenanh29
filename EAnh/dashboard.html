<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - EAnh</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        /* áº¨n trang web cho Ä‘áº¿n khi kiá»ƒm tra Ä‘Äƒng nháº­p xong Ä‘á»ƒ trÃ¡nh giáº­t lag */
        body { visibility: hidden; opacity: 0; transition: opacity 0.5s ease-in; }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">EAnh</div>
                <nav>
                    <ul class="nav-menu">
                        <li><a href="dashboard.html" class="active">Dashboard</a></li>
                        <li><a href="pages/profile.html">Há»“ sÆ¡ (<span id="navUserName">...</span>)</a></li>
                        <li><a href="#" onclick="handleLogout(event)">ÄÄƒng xuáº¥t</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="container" style="margin-top: 2rem;">
        <div class="dashboard-grid">
            <aside class="sidebar">
                <h3 style="margin-bottom: 1.5rem; color: var(--text-light);">Há»c táº­p</h3>
                <ul class="sidebar-menu">
                    <li><a href="pages/vocabulary.html"><span>ğŸ“š</span> <span>Tá»« vá»±ng</span></a></li>
                    <li><a href="pages/grammar.html"><span>ğŸ“–</span> <span>Ngá»¯ phÃ¡p</span></a></li>
                    <li><a href="pages/listening.html"><span>ğŸ§</span> <span>Luyá»‡n nghe</span></a></li>
                    <li><a href="pages/reading.html"><span>ğŸ“°</span> <span>Luyá»‡n Ä‘á»c</span></a></li>
                    <li><a href="pages/writing.html"><span>âœï¸</span> <span>Luyá»‡n viáº¿t</span></a></li>
                    <li><a href="pages/speaking.html"><span>ğŸ¤</span> <span>Luyá»‡n nÃ³i</span></a></li>
                </ul>

                <h3 style="margin: 1.5rem 0; color: var(--text-light);">Kiá»ƒm tra</h3>
                <ul class="sidebar-menu">
                    <li><a href="pages/mock-test.html"><span>ğŸ“</span> <span>Thi thá»­</span></a></li>
                    <li><a href="pages/result.html"><span>ğŸ“Š</span> <span>Káº¿t quáº£</span></a></li>
                </ul>
            </aside>

            <main>
                <h1 style="margin-bottom: 2rem;">ChÃ o má»«ng trá»Ÿ láº¡i, <span id="userName" style="color: #4F46E5;">Báº¡n</span>! ğŸ‘‹</h1>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="vocabCount">0</div>
                        <div class="stat-label">Tá»« vá»±ng Ä‘Ã£ há»c</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);">
                        <div class="stat-value" id="testsCompleted">0</div>
                        <div class="stat-label">BÃ i kiá»ƒm tra</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <div class="stat-value" id="studyStreak">0</div>
                        <div class="stat-label">NgÃ y liÃªn tiáº¿p</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #ec4899, #db2777);">
                        <div class="stat-value" id="avgScore">0%</div>
                        <div class="stat-label">Äiá»ƒm trung bÃ¬nh</div>
                    </div>
                </div>

                <h2 style="margin-bottom: 1.5rem;">Ká»¹ nÄƒng há»c táº­p</h2>
                <div class="grid grid-3">
                    <div class="card">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“š</div>
                        <h3 class="card-title">Tá»« vá»±ng</h3>
                        <p style="color: var(--text-gray); margin-bottom: 1rem;">Há»c tá»« vá»±ng theo chá»§ Ä‘á»</p>
                        <a href="pages/vocabulary.html" class="btn btn-primary">Báº¯t Ä‘áº§u</a>
                    </div>
                    <div class="card">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“–</div>
                        <h3 class="card-title">Ngá»¯ phÃ¡p</h3>
                        <p style="color: var(--text-gray); margin-bottom: 1rem;">Náº¯m vá»¯ng cáº¥u trÃºc cÃ¢u</p>
                        <a href="pages/grammar.html" class="btn btn-primary">Báº¯t Ä‘áº§u</a>
                    </div>
                    <div class="card">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ§</div>
                        <h3 class="card-title">Luyá»‡n nghe</h3>
                        <p style="color: var(--text-gray); margin-bottom: 1rem;">Cáº£i thiá»‡n ká»¹ nÄƒng nghe</p>
                        <a href="pages/listening.html" class="btn btn-primary">Báº¯t Ä‘áº§u</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Cáº¥u hÃ¬nh Ä‘Æ°á»ng dáº«n API tuyá»‡t Ä‘á»‘i (Äá»ƒ cháº¡y Ä‘Æ°á»£c cáº£ trÃªn Live Server)
        // Náº¿u folder dá»± Ã¡n cá»§a báº¡n trong htdocs lÃ  EANH thÃ¬ Ä‘á»ƒ nguyÃªn
        const BASE_API = 'http://localhost/EANH/backend'; 

        // 1. KIá»‚M TRA ÄÄ‚NG NHáº¬P NGAY Láº¬P Tá»¨C
        (function checkAuth() {
            const userInfo = localStorage.getItem('user_info');
            
            if (!userInfo) {
                // Náº¿u khÃ´ng cÃ³ thÃ´ng tin trong bá»™ nhá»› -> ÄÃ¡ vá» login
                window.location.replace('login.html');
            } else {
                // Náº¿u cÃ³ -> Hiá»‡n trang web lÃªn
                document.body.style.visibility = 'visible';
                document.body.style.opacity = '1';
                
                // Hiá»ƒn thá»‹ tÃªn ngÆ°á»i dÃ¹ng
                try {
                    const user = JSON.parse(userInfo);
                    if(document.getElementById('userName')) document.getElementById('userName').textContent = user.full_name;
                    if(document.getElementById('navUserName')) document.getElementById('navUserName').textContent = user.full_name;
                } catch (e) {
                    console.error("Lá»—i parse user info");
                }
            }
        })();

        // 2. HÃ€M ÄÄ‚NG XUáº¤T
        function handleLogout(e) {
            e.preventDefault();
            if(confirm('Báº¡n muá»‘n Ä‘Äƒng xuáº¥t?')) {
                localStorage.removeItem('user_info');
                window.location.replace('login.html');
            }
        }

        // 3. LOAD Sá» LIá»†U THá»NG KÃŠ (DÃ¹ng Ä‘Æ°á»ng dáº«n tuyá»‡t Ä‘á»‘i)
        async function loadStats() {
            try {
                // Gá»i API stats tá»« XAMPP
                const response = await fetch(`${BASE_API}/api/stats.php`);
                
                if (!response.ok) throw new Error("API Stats chÆ°a sáºµn sÃ ng");
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('vocabCount').textContent = data.vocab_count || 0;
                    document.getElementById('testsCompleted').textContent = data.tests_completed || 0;
                    document.getElementById('studyStreak').textContent = data.study_streak || 0;
                    document.getElementById('avgScore').textContent = (data.avg_score || 0) + '%';
                }
            } catch (error) {
                console.warn('KhÃ´ng láº¥y Ä‘Æ°á»£c thá»‘ng kÃª (CÃ³ thá»ƒ do chÆ°a cÃ³ file stats.php), dÃ¹ng sá»‘ liá»‡u máº·c Ä‘á»‹nh.');
            }
        }

        // Gá»i load stats sau khi giao diá»‡n Ä‘Ã£ hiá»‡n
        setTimeout(loadStats, 500);
    </script>
</body>
</html>