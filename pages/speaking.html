<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luy·ªán N√≥i - EAnh</title>
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">EAnh</div>
                <nav>
                    <ul class="nav-menu">
                        <li><a href="../dashboard.html">Dashboard</a></li>
                        <li><a href="speaking.html" class="active">Luy·ªán n√≥i</a></li>
                        <li><a href="../backend/auth/logout.php">ƒêƒÉng xu·∫•t</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="container" style="margin-top: 2rem; margin-bottom: 2rem;">
        <h1 style="margin-bottom: 2rem;">üé§ Luy·ªán N√≥i</h1>

        <div style="max-width: 900px; margin: 0 auto;">
            <!-- Topics -->
            <div class="card" style="margin-bottom: 2rem;">
                <h3 class="card-title">Ch·ªçn ch·ªß ƒë·ªÅ</h3>
                <div class="grid grid-3">
                    <button class="btn btn-outline" onclick="selectTopic('introduction')">üëã Gi·ªõi thi·ªáu b·∫£n th√¢n</button>
                    <button class="btn btn-outline" onclick="selectTopic('hobby')">üé® S·ªü th√≠ch</button>
                    <button class="btn btn-outline" onclick="selectTopic('work')">üíº C√¥ng vi·ªác</button>
                    <button class="btn btn-outline" onclick="selectTopic('travel')">‚úàÔ∏è Du l·ªãch</button>
                    <button class="btn btn-outline" onclick="selectTopic('technology')">üíª C√¥ng ngh·ªá</button>
                    <button class="btn btn-outline" onclick="selectTopic('education')">üìö Gi√°o d·ª•c</button>
                </div>
            </div>

            <!-- Practice Area -->
            <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 2rem;">
                <!-- Recording -->
                <div class="card">
                    <h3 class="card-title">üé§ Ghi √¢m</h3>
                    
                    <div id="questionDisplay" style="padding: 2rem; background: rgba(99, 102, 241, 0.1); border-radius: 8px; margin: 1rem 0; min-height: 150px; display: flex; align-items: center; justify-content: center;">
                        <p style="color: var(--text-gray); text-align: center;">Ch·ªçn ch·ªß ƒë·ªÅ ƒë·ªÉ xem c√¢u h·ªèi</p>
                    </div>

                    <div style="text-align: center; margin: 2rem 0;">
                        <button id="recordBtn" class="btn btn-primary" style="font-size: 1.2rem; padding: 1rem 2rem;" onclick="toggleRecording()" disabled>
                            üé§ B·∫Øt ƒë·∫ßu ghi √¢m
                        </button>
                        <p id="recordingStatus" style="color: var(--text-gray); margin-top: 1rem;">S·∫µn s√†ng</p>
                        <p id="timer" style="font-size: 2rem; margin-top: 1rem; display: none;">00:00</p>
                    </div>

                    <div id="audioPlayback" style="display: none; margin-top: 1rem;">
                        <h4 style="margin-bottom: 1rem;">Nghe l·∫°i:</h4>
                        <audio id="audioPlayer" controls style="width: 100%;"></audio>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button class="btn btn-success" onclick="saveRecording()">üíæ L∆∞u</button>
                            <button class="btn btn-outline" onclick="discardRecording()">üóëÔ∏è Ghi l·∫°i</button>
                        </div>
                    </div>
                </div>

                <!-- Tips & History -->
                <div>
                    <div class="card" style="margin-bottom: 1rem;">
                        <h3 class="card-title">üí° G·ª£i √Ω tr·∫£ l·ªùi</h3>
                        <div id="tips" style="color: var(--text-gray);">
                            <p>Ch·ªçn ch·ªß ƒë·ªÅ ƒë·ªÉ xem g·ª£i √Ω</p>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="card-title">üéµ B√†i n√≥i c·ªßa b·∫°n</h3>
                        <div id="recordingsList" style="max-height: 300px; overflow-y: auto;">
                            <p style="color: var(--text-gray); text-align: center; padding: 2rem;">Ch∆∞a c√≥ b√†i n√≥i n√†o</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sample Answers -->
            <div class="card" style="margin-top: 2rem;">
                <h3 class="card-title">üìù C√¢u tr·∫£ l·ªùi m·∫´u</h3>
                <div id="sampleAnswer" style="color: var(--text-gray);">
                    <p>Ch·ªçn ch·ªß ƒë·ªÅ ƒë·ªÉ xem c√¢u tr·∫£ l·ªùi m·∫´u</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const topics = {
            introduction: {
                question: 'Introduce yourself: What is your name? Where are you from? What do you do?',
                tips: [
                    'Start with a greeting',
                    'State your name clearly',
                    'Mention your hometown',
                    'Talk about your occupation or studies',
                    'Keep it concise (1-2 minutes)'
                ],
                sample: 'Hello, my name is John. I\'m from Ho Chi Minh City, Vietnam. I\'m currently working as a software developer at a tech company. I graduated from university two years ago with a degree in Computer Science. In my free time, I enjoy learning new technologies and playing sports.'
            },
            hobby: {
                question: 'What are your hobbies? Why do you enjoy them?',
                tips: [
                    'Name 2-3 hobbies',
                    'Explain why you like them',
                    'Give specific examples',
                    'Talk about how often you do them'
                ],
                sample: 'I have several hobbies that I really enjoy. First, I love reading books, especially fiction and self-development books. Reading helps me relax and learn new things. I also enjoy playing badminton on weekends with my friends. It\'s a great way to stay healthy and socialize. Additionally, I like cooking new recipes, which allows me to be creative and enjoy delicious food.'
            },
            work: {
                question: 'Describe your job or studies. What do you like about it?',
                tips: [
                    'Describe your role/field',
                    'Mention daily tasks',
                    'Talk about what you enjoy',
                    'Discuss challenges'
                ],
                sample: 'I work as a marketing manager at a digital agency. My job involves creating marketing strategies, managing social media campaigns, and analyzing market trends. What I love most about my job is the creativity it requires and the opportunity to work with diverse clients. Every project is different and challenging, which keeps my work interesting.'
            },
            travel: {
                question: 'Tell me about a place you have traveled to. What did you like about it?',
                tips: [
                    'Name the place',
                    'Describe what you did',
                    'Talk about memorable experiences',
                    'Explain why you liked it'
                ],
                sample: 'Last year, I visited Japan, and it was an amazing experience. I spent two weeks exploring Tokyo, Kyoto, and Osaka. What impressed me most was the blend of traditional culture and modern technology. I loved trying authentic Japanese cuisine, visiting ancient temples, and experiencing the efficiency of their public transportation system. The people were incredibly polite and helpful, making my trip even more enjoyable.'
            },
            technology: {
                question: 'How has technology changed your life? Is it mostly positive or negative?',
                tips: [
                    'Give specific examples',
                    'Discuss both benefits and drawbacks',
                    'Relate to personal experience',
                    'Provide balanced view'
                ],
                sample: 'Technology has significantly transformed my daily life. On the positive side, smartphones and internet access have made communication much easier. I can video call my family anytime and access information instantly. Online learning platforms have helped me develop new skills. However, I also recognize some negative aspects, such as excessive screen time and the pressure from social media. Overall, I believe the benefits outweigh the drawbacks if we use technology wisely.'
            },
            education: {
                question: 'What do you think makes a good teacher? Describe your favorite teacher.',
                tips: [
                    'List qualities of good teachers',
                    'Give specific examples',
                    'Talk about impact on students',
                    'Share personal experience'
                ],
                sample: 'I think a good teacher should be passionate about their subject, patient, and able to explain complex concepts clearly. My favorite teacher was my English teacher in high school. She made learning fun through interactive activities and always encouraged us to express our opinions. She was patient with our mistakes and created a supportive learning environment. Her teaching style inspired me to continue learning English even after graduating.'
            }
        };

        let currentTopic = null;
        let mediaRecorder = null;
        let audioChunks = [];
        let recordingInterval = null;
        let seconds = 0;

        function selectTopic(topicKey) {
            currentTopic = topicKey;
            const topic = topics[topicKey];

            document.getElementById('questionDisplay').innerHTML = `
                <h3 style="color: var(--text-light); text-align: center;">${topic.question}</h3>
            `;

            const tipsHTML = topic.tips.map(tip => `<li style="margin-bottom: 0.5rem;">${tip}</li>`).join('');
            document.getElementById('tips').innerHTML = `<ul style="padding-left: 1.5rem;">${tipsHTML}</ul>`;

            document.getElementById('sampleAnswer').innerHTML = `<p style="line-height: 1.8;">${topic.sample}</p>`;

            document.getElementById('recordBtn').disabled = false;
        }

        async function toggleRecording() {
            if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                await startRecording();
            } else {
                stopRecording();
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    document.getElementById('audioPlayer').src = audioUrl;
                    document.getElementById('audioPlayback').style.display = 'block';
                };

                mediaRecorder.start();
                
                document.getElementById('recordBtn').textContent = '‚èπÔ∏è D·ª´ng ghi √¢m';
                document.getElementById('recordBtn').classList.remove('btn-primary');
                document.getElementById('recordBtn').classList.add('btn-danger');
                document.getElementById('recordingStatus').textContent = 'ƒêang ghi √¢m...';
                document.getElementById('timer').style.display = 'block';

                // Start timer
                seconds = 0;
                recordingInterval = setInterval(() => {
                    seconds++;
                    const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
                    const secs = (seconds % 60).toString().padStart(2, '0');
                    document.getElementById('timer').textContent = `${mins}:${secs}`;
                }, 1000);

            } catch (error) {
                alert('Kh√¥ng th·ªÉ truy c·∫≠p microphone. Vui l√≤ng c·∫•p quy·ªÅn!');
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                
                document.getElementById('recordBtn').textContent = 'üé§ B·∫Øt ƒë·∫ßu ghi √¢m';
                document.getElementById('recordBtn').classList.remove('btn-danger');
                document.getElementById('recordBtn').classList.add('btn-primary');
                document.getElementById('recordingStatus').textContent = 'Ho√†n th√†nh';
                document.getElementById('timer').style.display = 'none';

                clearInterval(recordingInterval);
            }
        }

        async function saveRecording() {
            if (!currentTopic) return;

            try {
                // In a real app, you would upload the audio file to server
                alert('ƒê√£ l∆∞u b√†i n√≥i! (Ch·ª©c nƒÉng upload ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn)');
                
                // Add to list
                const list = document.getElementById('recordingsList');
                const timestamp = new Date().toLocaleString('vi-VN');
                list.innerHTML = `
                    <div style="padding: 1rem; border-bottom: 1px solid var(--border);">
                        <h4 style="margin-bottom: 0.5rem; color: var(--primary);">${topics[currentTopic].question.split(':')[0]}</h4>
                        <small style="color: var(--text-gray);">${timestamp}</small>
                    </div>
                ` + list.innerHTML;

                discardRecording();
            } catch (error) {
                alert('C√≥ l·ªói x·∫£y ra khi l∆∞u b√†i n√≥i');
            }
        }

        function discardRecording() {
            document.getElementById('audioPlayback').style.display = 'none';
            document.getElementById('audioPlayer').src = '';
            audioChunks = [];
        }
    </script>
</body>
</html>